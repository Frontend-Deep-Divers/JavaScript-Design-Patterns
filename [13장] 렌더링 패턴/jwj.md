# 13장 렌더링 패턴

- 클라이언트 사이드 렌더링
- 서버 사이드 렌더링
- 정적 렌더링
- 점진적 정적 생성(ISR): 초기 빌드 이후 정적 사이트 추가 및 수정
- 스트리밍 SSR
- 엣지 렌더링: 렌더링된 HTML을 전송하기 전 엣지에서 수정
- 하이브리드 렌더링: CSR과 SSR을 결합
- 부분 하이드레이션: 일부 컴포넌트를 하이드레이션
- 점진적 하이드레이션: 클라이언트에서 하이드레이션 순서를 제어
- 아일랜드 아키텍처: 정적 사이트 내 여러 진입점을 가진 동적인 동작의 격리된 영역을 만듦
- 점진적 향상: JS 없이 앱이 작동하도록 보장

# 렌더링 패턴의 중요성

렌더링 패턴은 UX 향상 및 DX 향상과 직결될 수 있다.

## DX 향상을 위한 요소

1. 빠른 빌드 시간
2. 낮은 서버 비용
3. 동적 콘텐츠
4. 쉬운 롤백
5. 안정적인 가동 시간
6. 확장 가능한 인프라

# 정적 렌더링

HTML을 빌드 시점에 미리 생성하여 다음 빌드 시까지 재생성되지 않는다. 동적인 데이터가 없는 회사 소개, 블로그 페이지 등에 적합하다.

## 점진적 정적 생성(ISR)

정적 렌더링과 SSR을 결합한 방식으로, 특정 정적 페이지만 미리 렌더링하고 동적 페이지는 사용자 요청 시에 on-demand 방식으로 렌더링한다. 대표적으로 Next.js, Gatsby, VuePress 등이 있다.

- 장점: 빌드 시간 단축, 캐시 자동 무효화 후 페이지 재생성

## On-demand ISR

특정 이벤트 발생 시 페이지가 생성되도록 하는 방식이다.

일반 ISR과 다르게 엣지 네트워크 전체에 페이지를 다시 생성하고 재분배한다. 이러한 장점으로 불필요한 페이지 재생성, 서버리스 함수 호출을 피할 수 있어 운영 비용 절감 효과가 있다.

# 스트리밍 SSR

HTML을 작은 조각(청크)로 나눠서 전송하는 방식이다.

네트워크 혼잡 시 렌더러는 신호를 받아 네트워크가 해소될 때까지 스트리밍을 중단하여 네트워크 혼잡을 완화한다. 열악한 환경에서도 사이트가 빠른 응답성을 유지할 수 있게 해준다.

리액트에서는 `renderToNodeStream`, `renderToStaticNodeStream` 메서드 등을 사용한다.

# 엣지 SSR

CDN의 모든 지역에서 서버 렌더링을 가능하게 해 콜드 부트 시간을 0에 가깝게 하는 방식이다.

서버리스 함수를 사용해 전체 페이지를 서버 사이드에서 생성할 수 있다.

활용 사례로 사용자별로 지역 특화 리스트 페이지가 있다. 페이지 대부분을 정적으로 생성해서 서빙하고, 리스트 부분만 외부 요청을 통해 가져온다. 리스트 컴포넌트만 서버 사이드에서 렌더링하고 나머지는 엣지 사이드에서 렌더링하도록 선택할 수 있다.

# 하이브리드 렌더링

여러 가지 렌더링 방식을 결합하는 방식을 말한다.

# 점진적 하이드레이션

각 노드를 시간에 따라 개별적으로 하이드레이션하여 필요한 최소한의 JS만 요청하는 방식이다.

상대적으로 덜 중요한 부분의 하이드레이션을 지연시켜 페이지를 상호작용할 수 있게 만드는 데 필요한 JS 코드의 양을 줄인다.

리액트의 동시성 모드가 이 방식을 구현하는 데 사용될 수 있다.

# 아일랜드 아키텍처

정적인 HTML 위에 **독립적으로 전달될 수 있는 상호작용 아일랜드**를 통해 JS 전송량을 줄이는 패러다임이다.

컴포넌트 기반 아키텍처로, 정적/동적 아일랜드로 구분된 페이지 뷰를 제안한다.

페이지가 개별 컴포넌트의 스케줄링 및 하이드레이션을 담당하는 점진적 하이드레이션과 달리, 아일랜드 아키텍처에서는 각 컴포넌트가 하이드레이션 스크립트를 가지며, 페이지의 다른 스크립트와 비동기적으로 실행된다.

Marko, Astro, Evenety + Preact 등의 프레임워크가 지원하고 있다.

- 장점: 클라이언트가 부담하는 JS 코드의 양이 적음, SEO에 유리, 중요 콘텐츠 즉시 서빙, 접근성, 컴포넌트 기반
- 단점: 초기 단계이므로 커뮤니티의 크기가 작음

# 리액트 서버 컴포넌트

서버에서 실행되도록 설계된 리액트 컴포넌트다.

RSC는 `async/await`를 사용해 데이터 페칭을 컴포넌트 트리의 필수 부분으로 통합해, 최상위 레벨에서 `await`를 사용해 서버 사이드 데이터 직렬화를 가능하게 한다. 이렇게 컴포넌트는 데이터를 정기적으로 다시 가져올 수 있다.

클라이언트의 번들 크기를 줄여준다.

Next.js의 App 라우터는 RSC를 지원한다. app 디렉토리 내 컴포넌트는 기본적으로 RSC로 작동한다.
